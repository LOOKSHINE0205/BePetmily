<!-- <%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%> -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ìš©ì ìœ„ì¹˜ ê¸°ë°˜ ì„œë¹„ìŠ¤</title>
    <link rel="stylesheet" href="../css/Base_style.css">
    <link rel="stylesheet" href="../css/map3.css">
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d65efe482352843c1373a29f486cdb0f"></script>
</head>
<body>
    <header>
        <div class="logo">
            <a href="main.html"><img src="../img/Base_logo.png" alt="Be Petmily Logo"></a>
        </div>
        
        <!-- ì£¼ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="main-nav">
            <ul>
                <!-- ê°œë³„ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì„¤ì • -->
                <li class="dropdown products-tab">
                    <a>ì œí’ˆ</a>
                    <div class="dropdown-content products-content">
                        <a href="../html/item_list.html">ì‚¬ë£Œ</a>
                        <a href="#">ê°„ì‹</a>
                        <a href="#">ìš©í’ˆ</a>
                    </div>
                </li>
                <li class="dropdown facilities-tab">
                    <a>ì‹œì„¤</a>
                    <div class="dropdown-content facilities-content">
                        <a href="#">ë³‘ì›</a>
                        <a href="#">ìˆ™ë°•</a>
                        <a href="#">ì¹´í˜/ì‹ë‹¹</a>
                        <a href="#">ê¸°íƒ€ì‹œì„¤</a>
                        <a href="../html/map.html">ì£¼ë³€ìœ„ì¹˜</a>
                    </div>
                </li>
                <li class="dropdown health-tab">
                    <a>ë§ì¶¤í˜• ì •ë³´</a>
                    <div class="dropdown-content health-content">
                        <!-- <a href="HealthCare.html" class="moveable">ê±´ê°•ê´€ë¦¬</a> -->
                        <a href="../html/DiseasePrediction.html" class="moveable">ì§ˆë³‘ì˜ˆì¸¡</a>
                    </div>
                </li>
                <li class="dropdown community-tab">
                    <a>ì»¤ë®¤ë‹ˆí‹°</a>
                    <div class="dropdown-content community-content">
                        <a href="../html/album_list.html">ì•¨ë²”ê²Œì‹œíŒ</a>
                    </div>
                </li>
            </ul>
        </nav>
        <hr>
        <!-- ë¸Œë ˆë“œí¬ëŸ¼ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="nav-background"></div>
        <div class="breadcrumb-background"></div> <!-- ì‚¬ê°í˜• ë„í˜•ì„ ì¶”ê°€ -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../html/main.html">í™ˆ</a><span>&gt;</span></li>
                <!-- <li class="breadcrumb-item"><a href="item_list.html">ì œí’ˆ</a><span>&gt;</span></li> -->
                <li class="breadcrumb-item active" aria-current="page">ì£¼ë³€ìœ„ì¹˜</li> 
            </ol>
        </nav>
        <div class="user-options">
            <a href="#"><img src="../img/Base_user.png" alt="User Icon"></a>
            <a href="#"><img src="../img/Base_cart.png" alt="Cart Icon"></a>
        </div>
    </header>

    <!-- Wrapper: ë©”ì¸ ì½˜í…ì¸  ë° í‘¸í„°ë¥¼ ì¤‘ì•™ì— ë°°ì¹˜ -->
    <div class="wrapper">
        <main>
            <section class="map-section">
                <div id="map" style="width:600px;height:400px;"></div>
                <div class="location-list">
                   <!--<h2>ê°€ê¹Œìš´ ì¥ì†Œ</h2>  --> 
                    <ul id="places-list">
                        <!-- ê°€ê¹Œìš´ ì¥ì†Œ ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </ul>
                </div>
            </section>
    </div>
        </main>
    </div>
    <!-- ë°°ë„ˆ: ì „ì²´ ë„ˆë¹„ë¡œ ì„¤ì • -->
    <section class="banner">
        <img src="../img/Base_banner.png" alt="Be Petmily Banner">
    </section>
    <footer class="footer-wrapper">
        <div class="footer-container">
            <div class="footer-top-bar">
                <span class="footer-lang">ğŸŒ ëŒ€í•œë¯¼êµ­/í•œêµ­ì–´ </span>
                <span class="footer-top"><a href="#" id="back-to-top1"><img src="../img/Base_up01.png" alt="ë§¨ ìœ„" srcset=""></a></span>
            </div>
             <hr> 
            <div class="footer-top">
                <div class="footer-links">
                    <h3>ì œí’ˆ</h3>
                    <ul>
                        <li><a href="../html/item_list.html">ì‚¬ë£Œ</a></li>
                        <li><a href="#">ê°„ì‹</a></li>
                        <li><a href="#">ìš©í’ˆ</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h3>ì• ê²¬ ê´€ë ¨ ì‹œì„¤</h3>
                    <ul>
                        <li><a href="#">ë³‘ì›</a></li>
                        <li><a href="#">ìˆ™ë°•</a></li>
                        <li><a href="#">ì¹´í˜/ì‹ë‹¹</a></li>
                        <li><a href="#">ê¸°íƒ€ì‹œì„¤</a></li>
                        <li><a href="../html/map.html">ì£¼ë³€ìœ„ì¹˜</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h3>ë§ì¶¤í˜• ì •ë³´</h3>
                    <ul>
                        <!-- <li><a href="HealthCare.html">ê±´ê°•ê´€ë¦¬</a></li> -->
                        <li><a href="../html/DiseasePrediction.html">ì§ˆë³‘ì˜ˆì¸¡</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h3>ì»¤ë®¤ë‹ˆí‹°</h3>
                    <ul>
                        <!-- <li><a href="#">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</a></li> -->
                        <li><a href="../html/album_list.html">ì•¨ë²”ê²Œì‹œíŒ</a></li>
                    </ul>   
                </div>
            </div>
            <hr>
            <div class="footer-contact">
                <p>Be Petmilyì™€ ìƒë‹´í•˜ì„¸ìš”</p>
                <p>í‰ì¼ 09:00 ~ 18:00 ì£¼ë§/ê³µíœ´ì¼ íœ´ë¬´</p>
                <p>070-123-4567</p>
                <a href="mailto:info@bepetmily.com">ë¬¸ì˜í•˜ê¸°</a>
            </div>
            <div class="footer-bottom">
                <p>ê°œì¸ì •ë³´ ë³´í˜¸ì„¼í„° | ë²•ë¥ ì •ë³´ | ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</p>
                <p>Â©2017 Be Petmily. All rights reserved. An Affiliate of Mars, Incorporated.</p>
            </div>
            <div class="back-to-top">
                <a href="#" id="back-to-top"><img src="../img/Base_up02.png" alt="ë§¨ ìœ„ë¡œ"></a>
            </div>
        </div>
    </footer>

   <!-- ì¹´ì¹´ì˜¤ ë§µ ë° ìœ„ì¹˜ ì •ë³´ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // ì§€ë„ í‘œì‹œí•  ì»¨í…Œì´ë„ˆì™€ ì˜µì…˜ ì„¤ì •
        var mapContainer = document.getElementById('map'); // ì§€ë„ë¥¼ í‘œì‹œí•  div
        var mapOption = {
            center: new kakao.maps.LatLng(33.450701, 126.570667), // ì§€ë„ì˜ ì¤‘ì‹¬ ì¢Œí‘œ
            level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
        };

        // ì§€ë„ë¥¼ ìƒì„±
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // ì‚¬ìš©ìì˜ í˜„ì¬ ìœ„ì¹˜ë¥¼ ì–»ê¸° ìœ„í•´ HTML5ì˜ geolocationì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var lat = position.coords.latitude; // ìœ„ë„
                var lon = position.coords.longitude; // ê²½ë„
                
                // íŠ¹ì • ìœ„ì¹˜ì¼ ë•Œ ìƒˆë¡œìš´ ê°’ìœ¼ë¡œ ë³€ê²½
                if (lat === 35.150654 && lon === 126.9131115) {
                    lat = 35.14663;
                    lon = 126.92228;
                }
                // ìœ„ë„ì™€ ê²½ë„ë¥¼ ì½˜ì†”ì— ì¶œë ¥
                console.log('Latitude:', lat, 'Longitude:', lon);
                
                var locPosition = new kakao.maps.LatLng(lat, lon); // ì‚¬ìš©ì ìœ„ì¹˜ë¡œ ìƒì„±ëœ ì¢Œí‘œ
                map.setCenter(locPosition); // ì§€ë„ ì¤‘ì‹¬ì„ ì‚¬ìš©ì ìœ„ì¹˜ë¡œ ì„¤ì •

                var marker = new kakao.maps.Marker({
                    position: locPosition // ë§ˆì»¤ ìœ„ì¹˜ë¥¼ ì‚¬ìš©ì ìœ„ì¹˜ë¡œ ì„¤ì •
                });
                marker.setMap(map); // ì§€ë„ì˜ ë§ˆì»¤ í‘œì‹œ

                // í…ŒìŠ¤íŠ¸ìš© ì¥ì†Œ ë°ì´í„° ë°°ì—´
                const placesData = [
                    {name: 'ì¥ì†Œ1', address: 'ì£¼ì†Œ1', phone: 'ì „í™”ë²ˆí˜¸1', lat: 37.5665, lon: 126.9780},
                    {name: 'ì¥ì†Œ2', address: 'ì£¼ì†Œ2', phone: 'ì „í™”ë²ˆí˜¸2', lat: 37.5651, lon: 126.9895},
                    {name: 'ì¥ì†Œ3', address: 'ì£¼ì†Œ3', phone: 'ì „í™”ë²ˆí˜¸3', lat: 37.5642, lon: 126.9931},
                    {name: 'ì¥ì†Œ4', address: 'ì£¼ì†Œ4', phone: 'ì „í™”ë²ˆí˜¸4', lat: 37.5634, lon: 126.9962},
                    {name: 'ì¥ì†Œ5', address: 'ì£¼ì†Œ5', phone: 'ì „í™”ë²ˆí˜¸5', lat: 37.5628, lon: 126.9981},
                    {name: 'ì¥ì†Œ6', address: 'ì£¼ì†Œ6', phone: 'ì „í™”ë²ˆí˜¸6', lat: 37.5615, lon: 127.0011},
                    {name: 'ì¥ì†Œ7', address: 'ì£¼ì†Œ7', phone: 'ì „í™”ë²ˆí˜¸7', lat: 37.5609, lon: 127.0030},
                    {name: 'ì¥ì†Œ8', address: 'ì£¼ì†Œ8', phone: 'ì „í™”ë²ˆí˜¸8', lat: 37.5599, lon: 127.0045},
                    {name: 'ì¥ì†Œ9', address: 'ì£¼ì†Œ9', phone: 'ì „í™”ë²ˆí˜¸9', lat: 37.5587, lon: 127.0065},
                    {name: 'ì¥ì†Œ10', address: 'ì£¼ì†Œ10', phone: 'ì „í™”ë²ˆí˜¸10', lat: 37.5576, lon: 127.0085},
                    {name: 'ì¥ì†Œ11', address: 'ì£¼ì†Œ11', phone: 'ì „í™”ë²ˆí˜¸11', lat: 37.5565, lon: 127.0105},
                ];

                // ì‚¬ìš©ì ìœ„ì¹˜ì™€ ê° ì¥ì†Œ ê°„ì˜ ê±°ë¦¬ ê³„ì‚°
                placesData.forEach(function(place) {
                    var distance = calculateDistance(lat, lon, place.lat, place.lon) / 1000; // km ë‹¨ìœ„ë¡œ ë³€í™˜
                    place.distance = distance; // ê° ì¥ì†Œ ê°ì²´ì— ê±°ë¦¬ ì¶”ê°€
                });

                // ê±°ë¦¬ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
                placesData.sort(function(a, b) {
                    return a.distance - b.distance; // ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
                });

                // ìƒìœ„ 10ê°œ ì¥ì†Œ í‘œì‹œ
                var top10 = placesData.slice(0, 8); // ìƒìœ„ 10ê°œ ì„ íƒ
                var placesList = document.getElementById('places-list');
                placesList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
                top10.forEach(function(place) {
                    var li = document.createElement('li'); // ë¦¬ìŠ¤íŠ¸ í•­ëª© ìƒì„±
                    li.innerHTML = `
                        <strong>ê±´ë¬¼ ì´ë¦„:</strong> ${place.name}<br>
                        <strong>ì£¼ì†Œ:</strong> ${place.address}<br>
                        <strong>ì „í™”ë²ˆí˜¸:</strong> ${place.phone}<br>
                        <strong>ê°€ê¹Œìš´ ê±°ë¦¬:</strong> ${place.distance.toFixed(2)} km
                    `; // ì¥ì†Œ ì •ë³´ í‘œì‹œ
                    placesList.appendChild(li); // ëª©ë¡ì— í•­ëª© ì¶”ê°€
                });
            }, function(error) {
                console.error('Error occurred. Error code: ' + error.code);
                // error.code can be:
                // 0: unknown error
                // 1: permission denied
                // 2: position unavailable (error response from location provider)
                // 3: timed out
            }, {
                enableHighAccuracy: true, // ê³ ì •ë°€ë„ ëª¨ë“œ
                timeout: 5000, // íƒ€ì„ì•„ì›ƒ ì„¤ì •
                maximumAge: 0 // ìœ„ì¹˜ ì •ë³´ ìºì‹œ ì‚¬ìš© ì•ˆ í•¨
            });
        } else {
            // GeoLocationì„ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ ë•Œ ê¸°ë³¸ ìœ„ì¹˜ ì„¤ì •
            var locPosition = new kakao.maps.LatLng(33.450701, 126.570667);
            map.setCenter(locPosition); // ì§€ë„ ì¤‘ì‹¬ì„ ê¸°ë³¸ ìœ„ì¹˜ë¡œ ì„¤ì •

            var marker = new kakao.maps.Marker({
                position: locPosition // ë§ˆì»¤ ìœ„ì¹˜ë¥¼ ê¸°ë³¸ ìœ„ì¹˜ë¡œ ì„¤ì •
            });
            marker.setMap(map); // ì§€ë„ì— ë§ˆì»¤ í‘œì‹œ
        }

        // ë‘ ì§€ì  ê°„ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ (ë‹¨ìœ„: ë¯¸í„°)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // ì§€êµ¬ ë°˜ê²½ (ë¯¸í„°)
            const Ï†1 = lat1 * Math.PI / 180; // Ï†, Î» in radians
            const Ï†2 = lat2 * Math.PI / 180;
            const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
            const Î”Î» = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
                      Math.cos(Ï†1) * Math.cos(Ï†2) *
                      Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            const distance = R * c; // in metres
            return distance; // ê±°ë¦¬ ë°˜í™˜
        }
    });
</script>
</body>